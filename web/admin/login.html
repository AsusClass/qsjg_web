<!doctype html>
<html>

	<head>
		<meta charset="UTF-8" />
		<title>『亲水建工』后台管理-登录</title>
		<link rel="icon" href="favicon.ico" />
		<link rel="stylesheet" type="text/css" href="css/admin_login.css" />
		<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.js"></script>
		<script src="js/js.js"></script>
		<script type="text/javascript" src="js/jump.js"></script>

	</head>

	<body>
		<div class="admin_login_wrap">
			<div class="titleDiv">
				<img src="images/favicon.png" alt="这里是图片" /> <span>管理员登录</span> </div>
			<div class="adming_login_border">
				<div class="admin_input">
					<form id="myform" method="post">
						<ul class="admin_items">
							<li>
								<label for="user">用户名：</label>
								<input type="text" name="user" value="" id="user" size="35" onblur="chkuser(this,'userMsg')" class="admin_input_style" />
								<p id="userMsg" style="color: red; display: inline;"></p>
							</li>
							<li>
								<label for="pwd">密码：</label>
								<input type="password" name="pwd" value="" id="pwd" size="35" onblur="chkvalue(this,'pwdMsg')" class="admin_input_style" />
								<p id="pwdMsg" style="color: red; display: inline;"></p>
							</li>
							<li>
								<input type="button" onclick="myLogin()" tabindex="3" value="提交" class="btn btn-primary" />
							</li>
						</ul>
					</form>
				</div>
			</div>
			<p class="admin_copyright">
				<a tabindex="5" href="http://www.ncqsjg.cn/" target="_blank">返回首页</a> &copy; 2018 Powered by
				<a href="http://ncqsjg.luov.top">NCUWork</a>
			</p>

		</div>
		<script type="text/javascript">
			function chkuser(txt, name) {
				var show = document.getElementById(name);
				if(txt.value == "") show.innerText = "输入不能为空";
				else show.style.display = "none";
			}

			function chkvalue(txt, name) {
				var relue = /^[a-zA-Z0-9_]{6,16}$/;
				//console.log(txt.value.match(relue));
				var show = document.getElementById(name);
				//console.log(show);
				if(txt.value == "") show.innerText = "输入不能为空";
				else if(txt.value.match(relue) == null) {
					show.innerText = "密码以字母开头，长度在6~18之间，只能包含字符、数字和下划线";
				} else show.style.display = "none";
			}

			function checkPwd(jsons) {
				var userRelue = /^[a-zA-Z0-9;]{3,16}$/;
				var pwdRelue = /^[a-zA-Z0-9_]{6,16}$/;
				if(jsons.user.length == 0) {
					alert("用户名不能为空");
					return false;
				} else if(jsons.pwd.length == 0) {
					alert("密码不能为空");
					return false;
				} else if(jsons.pwd.match(pwdRelue) == null) {
					alert("密码长度在6~18之间，只能包含字符、数字和下划线");
					return false;
				} else {
					return true;
				}
			}

			function myLogin() {
				var website = 'http://www.ncqsjg.cn:5555/';
				var myform = $("#myform");
				//返回字符串xxx=xxx&yyy=yyy;
				var formData = myform.serialize();
				$("#show").html(formData);
				// 返回的是json数组[{xxx:xxx},{yyy:yyy}]
				formData = myform.serializeArray();
				$("#show2").html(JSON.stringify(formData));

				//将json数组转为json 对象
				var jsons = transformToJson(formData);
				//console.log(jsons);
				$("#show3").html(JSON.stringify(jsons));
				//get是通过地址栏传参数
				var flag = checkPwd(jsons);
				if(flag == false) {
					//console.log("请检查您的输入");
				} else {
					$.ajax({
						url: website + "manage/login",
						cache: false,
						type: "post",
						datatype: "json",
						contentType: "application/x-www-form-urlencoded;charset=utf-8",
						data: jsons,
						success: function(data) {
							////console.log(data);
							if(data.code == "200") {
								//根据后台返回值确定是否操作成功
								document.cookie = setCookie("token", data.data.token, "3");
								document.cookie = setCookie("user", jsons.user, "3");
								window.location.href = "index.html";
							} else {
								alert("用户名或者密码错误");
							}
						}
					});
				}
			}
		</script>
	</body>

</html>
